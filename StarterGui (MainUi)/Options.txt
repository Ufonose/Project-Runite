local module = {}

function module.LOAD(MODULE_INFO)
	-- Basic Needs
	local MODULES = MODULE_INFO["MODULES"]
	local SERVICES = MODULE_INFO["SERVICES"]
	-- Services
	local RepStorage = SERVICES["ReplicatedStorage"]
	local Plrs = SERVICES["Players"]
	-- Modules
	local CASH_LIB = MODULES["CashLib"]
	local Main = MODULES["Main"]
	local ModernOptions = MODULES["ModernOptions"]
	-- Plr Info
	local Plr = Plrs.LocalPlayer
	-- Variables
	local DB = true

	-- Hide old Options GUI elements (keep the script but hide the frames)
	for _, child in pairs(script.Parent:GetChildren()) do
		if child:IsA("GuiObject") then
			child.Visible = false
		end
	end

	-- Create modern options UI
	local modernUI = ModernOptions.CREATE_MODERN_OPTIONS_UI(script.Parent.Parent)

	-- Function to update rebirth information
	local function updateRebirthInfo()
		local cost = CASH_LIB.GET_REBIRTH_COST(Plr)
		modernUI.CostValue.Text = "$" .. CASH_LIB.SUFFIX_NUM(cost)
		modernUI.RebirthValue.Text = tostring(Plr.leaderstats.Rebirths.Value)
	end

	-- Set up rebirth information updates
	updateRebirthInfo()
	Plr.Rebirth.Changed:Connect(updateRebirthInfo)
	Plr.leaderstats.Rebirths.Changed:Connect(updateRebirthInfo)

	-- Rebirth button functionality
	modernUI.RebirthButton.MouseButton1Click:Connect(function()
		if DB then
			DB = false
			local success = RepStorage.Events.Rebirth:InvokeServer()
			if success then
				warn("Rebirth Success!")
			end
			wait(0.1)
			DB = true
		end
	end)

	-- Close button functionality
	modernUI.CloseButton.MouseButton1Click:Connect(function()
		Main.CLOSE_MENU(script.Parent)
	end)

	-- Show/hide modern UI when MenuObject changes
	script.Parent.MenuObject.Changed:Connect(function()
		if script.Parent.MenuObject.Value then
			modernUI.Container.Visible = true
			updateRebirthInfo()  -- Update info when opening
		else
			modernUI.Container.Visible = false
		end
	end)
end

return module
