local ResearchData = {}

-- Define all research objectives
ResearchData.Objectives = {
	-- Tier 1 - Starting objectives
	{
		Id = 1,
		Name = "Stone Collector",
		Description = "Collect raw stone ore",
		Tier = 1,
		RequiredObjectives = {},
		Requirements = {
			{ItemName = "StoneOreModel", Amount = 10},
		},
		Rewards = {
			ResearchTokens = 5,
			UnlockMachines = {4,8}, -- Unlocks Standard Refiner (ID 4)
		},
		Icon = "rbxassetid://7435467441",
	},

	{
		Id = 2,
		Name = "Stone Refiner",
		Description = "Refine stone into processed ore",
		Tier = 1,
		RequiredObjectives = {},
		Requirements = {
			{ItemName = "StoneOreModel_Refined", Amount = 10},
		},
		Rewards = {
			ResearchTokens = 8,
			UnlockMachines = {5}, -- Unlocks another machine
		},
		Icon = "rbxassetid://7435467441",
	},

	-- Tier 2
	{
		Id = 3,
		Name = "Master Stone Processor",
		Description = "Process large quantities of stone",
		Tier = 2,
		RequiredObjectives = {1, 2},
		Requirements = {
			{ItemName = "StoneOreModel", Amount = 200},
			{ItemName = "StoneOreModel_Refined", Amount = 100},
		},
		Rewards = {
			ResearchTokens = 25,
			UnlockMachines = {6, 7},
		},
		Icon = "rbxassetid://7435467441",
	},
}

-- Get objective by ID
function ResearchData.GetObjective(objectiveId)
	for _, objective in pairs(ResearchData.Objectives) do
		if objective.Id == objectiveId then
			return objective
		end
	end
	return nil
end

-- Get all objectives for a tier
function ResearchData.GetObjectivesByTier(tier)
	local objectives = {}
	for _, objective in pairs(ResearchData.Objectives) do
		if objective.Tier == tier then
			table.insert(objectives, objective)
		end
	end
	return objectives
end

-- Get highest tier available
function ResearchData.GetMaxTier()
	local maxTier = 1
	for _, objective in pairs(ResearchData.Objectives) do
		if objective.Tier > maxTier then
			maxTier = objective.Tier
		end
	end
	return maxTier
end

-- Check if player can start an objective (prerequisites met)
function ResearchData.CanStartObjective(objectiveId, completedObjectives)
	local objective = ResearchData.GetObjective(objectiveId)
	if not objective then return false end

	-- Check if all required objectives are completed
	for _, requiredId in pairs(objective.RequiredObjectives) do
		if not table.find(completedObjectives, requiredId) then
			return false
		end
	end

	return true
end

-- NEW: Find which research objective unlocks a specific machine ID
function ResearchData.GetUnlockingResearch(machineId)
	for _, objective in pairs(ResearchData.Objectives) do
		if objective.Rewards.UnlockMachines then
			for _, unlockedId in pairs(objective.Rewards.UnlockMachines) do
				if unlockedId == machineId then
					return objective
				end
			end
		end
	end
	return nil -- No research unlocks this (default unlocked)
end

return ResearchData
