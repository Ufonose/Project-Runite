local Plrs = game:GetService("Players")
local RepStorage = game:GetService("ReplicatedStorage")
local ITEM_HANDLER = require(RepStorage.Modules.ItemHandler)
local ITEM_INFO = require(script.Parent.Parent.ItemStats)
local PLOT = script.Parent.Parent.Parent.Parent

-- Random spread settings
local SPREAD_WIDTH = 2  -- Left/right spread in studs

while wait(ITEM_INFO.DropSpeed) do
	local plot_owner = Plrs:FindFirstChild(PLOT.Owner.Value)
	if plot_owner ~= nil then
		if plot_owner.Settings.MinesActive.Value then
			local ORE, CASH_VALUE = ITEM_HANDLER.DROP_ORE(PLOT, script.Parent.Parent, script.Parent.Drop, Vector3.new(ITEM_INFO.DropSize, ITEM_INFO.DropSize, ITEM_INFO.DropSize), ITEM_INFO.DropColor, ITEM_INFO.DropMaterial, ITEM_INFO.DropWorth)
			if ORE then
				-- NEW: Add random left/right offset only
				local randomX = math.random(-SPREAD_WIDTH/2 * 100, SPREAD_WIDTH/2 * 100) / 100

				-- Handle both Models and single BaseParts
				local currentCFrame
				if ORE:IsA("Model") then
					currentCFrame = ORE:GetPivot()  -- Modern way to get Model position
					local newCFrame = currentCFrame * CFrame.new(randomX, 0, 0)
					ORE:PivotTo(newCFrame)
				elseif ORE:IsA("BasePart") then
					currentCFrame = ORE.CFrame
					ORE.CFrame = currentCFrame * CFrame.new(randomX, 0, 0)
				end

				ORE.Parent = PLOT.MiscInfo.OresDropped

				-- Set network ownership properly for models vs parts
				if ORE:IsA("Model") then
					if ORE.PrimaryPart then
						ORE.PrimaryPart:SetNetworkOwner(plot_owner)
					end
				elseif ORE:IsA("BasePart") then
					ORE:SetNetworkOwner(plot_owner)
				end
			end
		end
	end
end
