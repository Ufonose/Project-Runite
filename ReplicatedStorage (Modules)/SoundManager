-- ReplicatedStorage/Modules/SoundManager.lua
-- Handles all UI and game sounds with player settings support

local SoundService = game:GetService("SoundService")
local Players = game:GetService("Players")

local module = {}

-- Sound configuration (you can change these asset IDs to your own sounds)
local SOUNDS = {
	-- UI Sounds
	MenuOpen = "rbxassetid://93927627634818",
	MenuClose = "rbxassetid://93927627634818",
	ButtonClick = "rbxassetid://93927627634818",
	ButtonHover = "rbxassetid://93927627634818",

	-- Placement Sounds
	PlaceItem = "rbxassetid://93927627634818",
	RotateItem = "rbxassetid://93927627634818",
	CancelPlace = "rbxassetid://93927627634818",

	-- Notification Sounds
	Success = "rbxassetid://17692186009",
	Error = "rbxassetid://91660275693179",
	Purchase = "rbxassetid://93927627634818",
}

-- Volume settings
local VOLUMES = {
	MenuOpen = 0.4,
	MenuClose = 0.2,
	ButtonClick = 0.4,
	ButtonHover = 0.2,
	PlaceItem = 0.4,
	RotateItem = 0.3,
	CancelPlace = 0.3,
	Success = 0.5,
	Error = 0.5,
	Purchase = 0.4,
}

-- Sound categories for settings check
local SOUND_CATEGORIES = {
	-- UI & Placement Sounds (controlled by UISounds setting)
	UISounds = {
		"MenuOpen", "MenuClose", "ButtonClick", "ButtonHover",
		"PlaceItem", "RotateItem", "CancelPlace"
	},
	-- Notification Sounds (controlled by NotificationSounds setting)
	NotificationSounds = {
		"Success", "Error", "Purchase"
	}
}

-- Pre-created sound instances (created once, reused many times)
local soundInstances = {}

-- Initialize all sounds (call this once when the module loads)
local function initializeSounds()
	for soundName, soundId in pairs(SOUNDS) do
		local sound = Instance.new("Sound")
		sound.Name = soundName
		sound.SoundId = soundId
		sound.Volume = VOLUMES[soundName] or 0.5
		sound.Parent = SoundService

		soundInstances[soundName] = sound
	end

	print("SoundManager: All sounds pre-loaded!")
end

-- Initialize sounds immediately
initializeSounds()

-- Helper function to check if a sound should play based on player settings
local function shouldPlaySound(soundName)
	local player = Players.LocalPlayer
	if not player then return true end  -- If no player (shouldn't happen), allow sound

	local settings = player:FindFirstChild("Settings")
	if not settings then return true end  -- If no settings folder, allow sound

	-- Check if this sound is a UI/Placement sound
	if table.find(SOUND_CATEGORIES.UISounds, soundName) then
		local uiSoundsSetting = settings:FindFirstChild("UISounds")
		if uiSoundsSetting then
			return uiSoundsSetting.Value  -- Return the setting value (true = play, false = mute)
		end
	end

	-- Check if this sound is a Notification sound
	if table.find(SOUND_CATEGORIES.NotificationSounds, soundName) then
		local notificationSoundsSetting = settings:FindFirstChild("NotificationSounds")
		if notificationSoundsSetting then
			return notificationSoundsSetting.Value  -- Return the setting value
		end
	end

	return true  -- Default to allowing sound if category not found
end

-- Play a sound (instant - no delay!) with settings check
function module.PlaySound(soundName)
	-- Check if sound should play based on player settings
	if not shouldPlaySound(soundName) then
		return  -- Don't play if setting is disabled
	end

	local sound = soundInstances[soundName]

	if sound then
		-- Stop if already playing (allows rapid clicking)
		sound.TimePosition = 0
		sound:Play()
	else
		warn("Sound not found:", soundName)
	end
end

-- Convenience functions for common sounds
function module.MenuOpen()
	module.PlaySound("MenuOpen")
end

function module.MenuClose()
	module.PlaySound("MenuClose")
end

function module.ButtonClick()
	module.PlaySound("ButtonClick")
end

function module.ButtonHover()
	module.PlaySound("ButtonHover")
end

function module.PlaceItem()
	module.PlaySound("PlaceItem")
end

function module.RotateItem()
	module.PlaySound("RotateItem")
end

function module.CancelPlace()
	module.PlaySound("CancelPlace")
end

function module.Success()
	module.PlaySound("Success")
end

function module.Error()
	module.PlaySound("Error")
end

function module.Purchase()
	module.PlaySound("Purchase")
end

return module
